from datetime import datetime

# ===== MODELS =====
class Task:
    def __init__(self, title, assigned_to, deadline):
        self.title = title
        self.assigned_to = assigned_to
        self.deadline = deadline  # datetime object
        self.status = "Not Started"
        self.history = []

    def update_status(self, new_status):
        self.history.append((self.status, datetime.now()))
        self.status = new_status

    def __str__(self):
        return f"[{self.status}] {self.title} - Assigned to: {self.assigned_to}, Deadline: {self.deadline.strftime('%Y-%m-%d')}"

class Transaction:
    def __init__(self, amount, type, description, date=None):
        self.amount = amount
        self.type = type
        self.description = description
        self.date = date or datetime.now()

    def __str__(self):
        return f"{self.date.strftime('%Y-%m-%d %H:%M')} | {self.type} | {self.amount} | {self.description}"

class Finance:
    def __init__(self):
        self.transactions = []

    def add_transaction(self, transaction):
        self.transactions.append(transaction)

    def report(self):
        income = sum(t.amount for t in self.transactions if t.type == "Thu")
        expense = sum(t.amount for t in self.transactions if t.type == "Chi")
        balance = income - expense
        return {"income": income, "expense": expense, "balance": balance}

# ===== TASK MANAGEMENT =====
tasks = []

def add_task(title, assigned_to, deadline_str):
    deadline = datetime.strptime(deadline_str, "%Y-%m-%d")
    task = Task(title, assigned_to, deadline)
    tasks.append(task)
    print("Task added successfully!")

def list_tasks():
    if not tasks:
        print("No tasks yet.")
    for i, task in enumerate(tasks, 1):
        print(f"{i}. {task}")

def update_task_status(task_index, new_status):
    if 0 <= task_index < len(tasks):
        tasks[task_index].update_status(new_status)
        print(f"Task '{tasks[task_index].title}' updated to {new_status}")
    else:
        print("Invalid task index")

# ===== FINANCE MANAGEMENT =====
finance = Finance()

def add_transaction(amount, type, description):
    txn = Transaction(amount, type, description)
    finance.add_transaction(txn)
    print("Transaction added successfully!")

def show_report():
    report = finance.report()
    print("\n===== Financial Report =====")
    print(f"Total Income: {report['income']}")
    print(f"Total Expense: {report['expense']}")
    print(f"Balance: {report['balance']}")
    print("============================\n")

# ===== CLI MENU =====
def main_menu():
    print("\n===== Club Manager =====")
    print("1. Add Task")
    print("2. List Tasks")
    print("3. Update Task Status")
    print("4. Add Transaction")
    print("5. Show Finance Report")
    print("0. Exit")
    choice = input("Select option: ")
    return choice

# ===== MAIN LOOP =====
while True:
    choice = m
